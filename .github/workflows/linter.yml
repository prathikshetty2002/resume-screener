name: Lint Code Base on PR

on:
  pull_request:
    branches: [ main ]

jobs:
  lint:
    name: Lint Changed Files
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'

    - name: Install Linter (Flake8)
      run: |
        python -m pip install --upgrade pip
        pip install flake8

    - name: Fetch PR Base and Head SHAs
      id: pr_info
      uses: actions/github-script@v3
      with:
        script: |
          const pr = await github.pulls.get({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: context.issue.number
          });
          return { base_sha: pr.data.base.sha, head_sha: pr.data.head.sha };

    - name: Get Changed Files
      run: |
        base_sha="${{ steps.pr_info.outputs.base_sha }}"
        head_sha="${{ steps.pr_info.outputs.head_sha }}"
        echo "Base SHA: $base_sha"
        echo "Head SHA: $head_sha"
        changed_files=$(git diff --name-only $base_sha $head_sha | grep '\.py$' || echo "")
        echo "Changed Python files: $changed_files"
        if [ -z "$changed_files" ]; then
          echo "No Python files changed"
          exit 0
        fi
        echo "changed_files=$changed_files" >> $GITHUB_ENV

    - name: Run Linter on Changed Files
      run: |
        if [ -n "$changed_files" ]; then
          echo "Running Flake8 on changed files:"
          echo $changed_files
          flake8 $changed_files
        else
          echo "No Python files changed"
